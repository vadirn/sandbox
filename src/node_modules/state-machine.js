import { observable, setChanged } from 'observable';

export function stateMachine(entryStateValue, description) {
  const state = observable(entryStateValue);

  function transition(stateValue) {
    if (stateValue !== undefined) {
      setChanged(state, stateValue);
    }
  }

  function receive(event) {
    description[state.current]?.[event.type]?.(transition, event);
  }

  return {
    subscribe: state.subscribe,
    receive,
    description,
    get current() {
      return state.current;
    },
  };
}
